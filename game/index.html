<!DOCTYPE html>
<html>
    <head>
        <title>Aprendendo Canvas</title>
        <style>
            canvas {
                border:solid black 1px;
            }
        </style>
        
        <script src="../scripts/rpgmanager.js"></script>
        <script src="../scripts/loadobject.js"></script>
        <script src="../scripts/gosprite.js"></script>
        <script src="../scripts/rpgobjetos.js"></script>
    </head>
    <body>
        <canvas id="canvas" width="600" height="600"></canvas>
        <script>
            var canvas = document.querySelector("canvas");
            var ctx = canvas.getContext("2d");

            var rpgmanager = new RPGManager (canvas, ctx);
            
            function gameloop ()
            {
                window.requestAnimationFrame(gameloop, canvas);
                rpgmanager.gameloop();
            }

            function mouseClick (e){
                let iat = rpgmanager.iaTargets;
                let tgt = iat[rpgmanager.jogador];
                let pos = rpgmanager.canvas.getBoundingClientRect();
                let offsetX = - pos.left;
                let offsetY = - pos.top;
                
                tgt.positionX = e.clientX-(rpgmanager.canvas.width/2)+offsetX;
                tgt.positionY = e.clientY-(rpgmanager.canvas.height/2)+offsetY;
            }

            
            rpgmanager.LoadCharacters ("data/personagens.json");
            rpgmanager.LoadMap ("data/mapa1.json", "data/tilesheet1.json");
            
            gameloop();
            window.addEventListener("click", mouseClick, false);
        </script>
    </body>
</html>
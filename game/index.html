<!DOCTYPE html>
<html>
    <head>
        <title>Aprendendo Canvas</title>
        <style>
            canvas {border:solid black 1px; background-image: url("mapa.png"); background-repeat: no-repeat; background-size: cover;}
        </style>
        <script src="../scripts/loadobject.js"></script>
        <script src="../scripts/gosprite.js"></script>
        <script src="../scripts/rpgobjetos.js"></script>
        <script src="../scripts/rpgmanager.js"></script>
    </head>
    <body>
        <canvas id="canvas" width="600" height="600"></canvas>
        <script>
            var canvas = document.querySelector("canvas");
            var ctx = canvas.getContext("2d");

            /*new DynamicObjeto(new AnimatedSprite(GameObjeto.defaultFrame, "sprites/tilemap_packed.png", 23), 0, 0, 64, 0, false, 2, 1),
            new DynamicObjeto(new AnimatedSprite(GameObjeto.defaultFrame, "sprites/tilemap_packed.png", 104), 250, 50, 64, 0, false, 2, 3), 
            new DynamicObjeto(new AnimatedSprite(GameObjeto.defaultFrame, "sprites/tilemap_packed.png", 185), 50, 250, 64, 0, false, 2, .5),
            new DynamicObjeto(new AnimatedSprite(GameObjeto.defaultFrame, "sprites/tilemap_packed.png", 266), 50, 50, 64, 0, false, 3, 1),*/
            
            var map;
            var tiles = [];
            var gameObjetos = [];
            
            var rpgmanager = new RPGManager (canvas, ctx, gameObjetos, tiles);
            
            function gameloop ()
            {
                window.requestAnimationFrame(gameloop, canvas);
                rpgmanager.gameloop();
            }

            function mouseClick (e){
                //let gameObjeto = gameObjetos[jogador];
                let iat = rpgmanager.iaTargets;
                //console.log(iat + "," + rpgmanager.jogador);
                let tgt = iat[rpgmanager.jogador];
                //console.log(tgt);
                let pos = rpgmanager.canvas.getBoundingClientRect();
                let offsetX = - pos.left;
                let offsetY = - pos.top;
                
                tgt.positionX = e.clientX-(rpgmanager.canvas.width/2)+offsetX;
                tgt.positionY = e.clientY-(rpgmanager.canvas.height/2)+offsetY;
            }

            rpgmanager.LoadCharacters (gameObjetos, "data/personagens.json");
            
            //rpgmanager.LoadMap (map, "data/mapa1.json");

            gameloop();
            window.addEventListener("click", mouseClick, false);

        </script>
    </body>
</html>